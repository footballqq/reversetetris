# Build & éƒ¨ç½²è¯´æ˜ï¼ˆCloudflare Pagesï¼‰

æœ¬æ–‡é¢å‘å½“å‰éƒ¨ç½²å½¢æ€ï¼šç«™ç‚¹æŒ‚åœ¨å­è·¯å¾„ `https://circlecal.pages.dev/reversetetris/`ï¼Œå¹¶ä¸”ä½ æŠŠæœ¬é¡¹ç›®çš„ `dist/` åŒæ­¥åˆ°å¦ä¸€ä¸ª GitHub ä»“åº“ï¼Œå†ç”± Cloudflare Pages ä½œä¸ºâ€œçº¯é™æ€ç«™ç‚¹â€æ‰˜ç®¡ã€‚

---

## 1. ä¸ºä»€ä¹ˆä¼šâ€œé»‘å±åªå‰©ğŸ”‡æŒ‰é’®â€

ç°è±¡ï¼šé¡µé¢èƒ½æ‰“å¼€ï¼Œä½†ç”»é¢å…¨é»‘ï¼Œåªæ˜¾ç¤ºä¸€ä¸ªå£°éŸ³æŒ‰é’®ï¼ˆğŸ”‡ï¼‰ã€‚

åŸå› ï¼š`dist/index.html` é‡Œ JS/CSS çš„å¼•ç”¨è·¯å¾„ä¸å¯¹ï¼Œå¯¼è‡´æµè§ˆå™¨æ²¡åŠ è½½åˆ°è„šæœ¬ï¼›é¡µé¢åªå‰©ä¸‹ HTML åˆå§‹å†…å®¹ï¼ˆæœ¬é¡¹ç›®åˆå§‹ HTML é‡Œç¡®å®åªæœ‰æŒ‰é’®ï¼‰ã€‚

åœ¨å­è·¯å¾„éƒ¨ç½²ï¼ˆ`/reversetetris/`ï¼‰æ—¶ï¼Œ**æœ€å¸¸è§é”™è¯¯**æ˜¯èµ„æºç”¨äº†æ ¹è·¯å¾„ï¼š

- é”™è¯¯ï¼š`/assets/index-xxx.js`ï¼ˆä¼šå»ç«™ç‚¹æ ¹ç›®å½• `/assets/...` æ‰¾ï¼‰
- æ­£ç¡®ï¼ˆå­è·¯å¾„ï¼‰ï¼š`/reversetetris/assets/index-xxx.js`
- æ›´ç¨³å¦¥ï¼š`./assets/index-xxx.js`ï¼ˆç›¸å¯¹è·¯å¾„ï¼Œæ”¾å“ªé‡Œéƒ½èƒ½è·‘ï¼‰

ä½ å½“å‰ç«™ç‚¹å±äºâ€œåŒä¸€ä¸ªåŸŸåä¸‹æŒ‚å¤šä¸ªåº”ç”¨â€çš„æƒ…å†µï¼š`/assets/...` å¯èƒ½å‘½ä¸­äº†å¦ä¸€ä¸ªç«™ç‚¹çš„èµ„æºæˆ– fallback HTMLï¼ˆContent-Type å˜æˆ `text/html`ï¼‰ï¼Œæœ€ç»ˆå¯¼è‡´æ¨¡å—è„šæœ¬åŠ è½½å¤±è´¥ã€‚

---

## 2. æœ¬é¡¹ç›®æ¨èçš„æ„å»ºé…ç½®

å·²åœ¨ `vite.config.ts` è®¾ç½®ï¼š

- `base: './'`

æ•ˆæœï¼šæ„å»ºè¾“å‡ºçš„ `dist/index.html` ä¼šä½¿ç”¨ `./assets/...` çš„ç›¸å¯¹è·¯å¾„ï¼Œé€‚åˆæ”¾åˆ°ä»»æ„å­ç›®å½•ï¼ˆæ¯”å¦‚ `/reversetetris/`ï¼‰æˆ–ç›´æ¥ä¸Šä¼ é™æ€æ–‡ä»¶ã€‚

---

## 3. æœ¬åœ°æ„å»ºï¼ˆç”Ÿæˆ distï¼‰

åœ¨æœ¬é¡¹ç›®ä»“åº“æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
npm install
npm run build
```

äº§ç‰©ç›®å½•ï¼š`dist/`

é‡è¦ï¼šä¸è¦ç”¨â€œç›´æ¥åŒå‡»æ‰“å¼€â€`dist/index.html`ï¼ˆ`file://` åè®®ï¼‰æ¥éªŒè¯ã€‚

- Vite æ„å»ºäº§ç‰©ä½¿ç”¨ ESMï¼ˆ`<script type="module">`ï¼‰ï¼Œå¤šæ•°æµè§ˆå™¨åœ¨ `file://` ä¸‹ä¼šå› ä¸ºå®‰å…¨ç­–ç•¥/CORS ç›´æ¥é˜»æ­¢æ¨¡å—è„šæœ¬åŠ è½½ã€‚
- ç»“æœè¡¨ç°å°±æ˜¯ï¼šJS æ²¡è¿è¡Œï¼Œé¡µé¢åªå‰©åˆå§‹ HTMLï¼ˆåªçœ‹åˆ° ğŸ”‡ æŒ‰é’®ï¼Œç”»é¢é»‘ï¼‰ã€‚

æœ¬åœ°éªŒè¯è¯·ç”¨ HTTP é™æ€æœåŠ¡å™¨ï¼ˆä»»é€‰å…¶ä¸€ï¼‰ï¼š

```bash
# ä½¿ç”¨é¡¹ç›®è‡ªå¸¦è„šæœ¬ï¼ˆæ¨èï¼‰
npm run preview
```

æˆ–ï¼š

```bash
# ä»»æ„é™æ€æœåŠ¡å™¨ä¹Ÿå¯ä»¥
npx serve dist
```

è‡ªæŸ¥æ„å»ºç»“æœï¼ˆå…³é”®ç‚¹ï¼‰ï¼š

- `dist/index.html` é‡Œèµ„æºåº”ç±»ä¼¼ `./assets/index-*.js`ã€`./assets/index-*.css`
- `dist/assets/` ä¸‹å­˜åœ¨å¯¹åº”çš„æ–‡ä»¶

---

## 4. éƒ¨ç½²åˆ° Cloudflare Pagesï¼ˆä½ å½“å‰â€œé™æ€ä»“åº“åŒæ­¥â€æ–¹æ¡ˆï¼‰

ç›®æ ‡ï¼šè®©æœ€ç»ˆçº¿ä¸Šç›®å½•ç»“æ„å˜æˆï¼š

```
https://circlecal.pages.dev/reversetetris/
  â”œâ”€ index.html
  â””â”€ assets/
      â”œâ”€ index-xxxx.js
      â””â”€ index-xxxx.css
```

æ“ä½œæ­¥éª¤ï¼š

1. åœ¨æœ¬é¡¹ç›®æ‰§è¡Œ `npm run build`
2. æŠŠæœ¬é¡¹ç›®çš„ `dist/` **é‡Œé¢çš„å†…å®¹**æ‹·è´/åŒæ­¥åˆ°â€œé™æ€ä»“åº“â€çš„ `reversetetris/` ç›®å½•ä¸‹ï¼š
   - å¤åˆ¶ `dist/index.html` â†’ `reversetetris/index.html`
   - å¤åˆ¶ `dist/assets/` â†’ `reversetetris/assets/`
3. æäº¤å¹¶æ¨é€â€œé™æ€ä»“åº“â€ï¼Œç­‰å¾… Cloudflare Pages è‡ªåŠ¨æ›´æ–°

å¸¸è§å‘ï¼š

- ä¸è¦å¤šå¥—ä¸€å±‚ç›®å½•ï¼šé¿å…å˜æˆ `reversetetris/dist/index.html`
- å¦‚æœä½ ç”¨è„šæœ¬åŒæ­¥ï¼Œç¡®ä¿æ—§çš„ `assets/` ä¼šè¢«æ›¿æ¢ï¼ˆæ–‡ä»¶åå¸¦ hashï¼Œæ¯æ¬¡æ„å»ºéƒ½ä¼šå˜ï¼‰

---

## 5. çº¿ä¸Šå¿«é€Ÿæ’æŸ¥æ¸…å•

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆNetworkï¼‰æ£€æŸ¥ï¼š

- `.../reversetetris/` çš„ HTML é‡Œæ˜¯å¦å¼•ç”¨ `./assets/...`ï¼ˆæˆ– `/reversetetris/assets/...`ï¼‰
- è®¿é—® `https://circlecal.pages.dev/reversetetris/assets/index-*.js`
  - æ­£ç¡®ï¼šå“åº”å¤´ `Content-Type: application/javascript`
  - é”™è¯¯ï¼š`text/html`ï¼ˆé€šå¸¸æ˜¯ 404 fallback æˆ–å‘½ä¸­äº†åˆ«çš„é¡µé¢ï¼‰

---

## 6. å¯é€‰æ–¹æ¡ˆï¼ˆæ›´çœç»´æŠ¤ï¼‰

å¦‚æœä½ ä¸æƒ³ç»´æŠ¤â€œå¦ä¸€ä¸ªé™æ€ä»“åº“ + æ‰‹åŠ¨æ‹·è´ distâ€ï¼š

- ç›´æ¥ç”¨ Cloudflare Pages å…³è”æœ¬é¡¹ç›®ä»“åº“
  - Build commandï¼š`npm run build`
  - Output directoryï¼š`dist`

æ³¨æ„ï¼šè¿™ç§æ–¹å¼é»˜è®¤éƒ¨ç½²åœ¨ç«™ç‚¹æ ¹è·¯å¾„ï¼ˆ`/`ï¼‰ã€‚å¦‚æœä½ å¿…é¡»ä¿ç•™åœ¨ `/reversetetris/` å­è·¯å¾„ï¼Œéœ€è¦é€šè¿‡è·¯ç”±/å¤šé¡¹ç›®æ‹†åˆ†/æˆ–è€…æ”¹ä¸ºå›ºå®š `base: '/reversetetris/'` çš„å‘å¸ƒç­–ç•¥ï¼ˆç›¸å¯¹è·¯å¾„æ–¹æ¡ˆ `base: './'` é€šå¸¸æœ€çœå¿ƒï¼‰ã€‚
