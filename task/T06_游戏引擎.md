# T06 - 游戏引擎 (GameEngine)

## 阶段
**Phase 4: 交互层**

## 目标
整合所有模块，实现完整的游戏循环和状态管理。

## 任务清单

### 6.1 游戏状态机
- [x] 创建 `src/core/GameEngine.ts`
- [x] 定义游戏状态枚举
```typescript
enum GameState {
  MENU,        // 主菜单
  SELECTING,   // 玩家选择方块中
  AI_PLAYING,  // AI 放置方块中
  PAUSED,      // 暂停
  WIN,         // 玩家胜利（AI 触顶）
  LOSE,        // 玩家失败（AI 达成目标）
}
```

### 6.2 核心游戏循环
- [x] `start(levelConfig)`: 开始新游戏
- [x] `update(deltaTime)`: 每帧更新
- [x] `render()`: 调用 Renderer 绘制
- [x] `pause() / resume()`: 暂停/恢复

### 6.3 回合流程
```
1. 生成 3 个随机方块 → 进入 SELECTING 状态
2. 等待玩家选择 → 玩家点击后
3. 进入 AI_PLAYING 状态
4. AI 计算最佳位置（异步，0.5s 动画）
5. 方块下落并锁定
6. 检查消行
7. 检查胜负条件
8. 回到步骤 1
```

### 6.4 事件系统
- [x] `on(event, callback)`: 事件监听
- [x] 触发事件：`pieceSelected`, `pieceLocked`, `linesCleared`, `gameOver`

### 6.5 游戏数据
```typescript
interface GameData {
  level: number;
  linesCleared: number;
  piecesPlaced: number;
  targetLines: number;  // AI 需要消除的行数
  aiDifficulty: AIWeights;
}
```

## 验收标准
- 完整的游戏流程可以运行
- 状态切换正确
- 胜负判定正确

## 预计工时
4-5 小时

## 依赖
- T02（Grid）
- T03（Piece）
- T04（Renderer）
- T05（AI）
